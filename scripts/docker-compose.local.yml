version: '3.8'

services:
  # DynamoDB Local - for testing DynamoDB integration
  dynamodb-local:
    image: amazon/dynamodb-local:latest
    container_name: genai-toolbox-dynamodb
    ports:
      - "8000:8000"
    command: "-jar DynamoDBLocal.jar -sharedDb -inMemory"
    networks:
      - genai-toolbox-net

  # MinIO - S3-compatible object storage
  minio:
    image: minio/minio:latest
    container_name: genai-toolbox-minio
    ports:
      - "9000:9000"  # API
      - "9001:9001"  # Console
    environment:
      MINIO_ROOT_USER: admin
      MINIO_ROOT_PASSWORD: password
    command: server /data --console-address ":9001"
    volumes:
      - minio-data:/data
    networks:
      - genai-toolbox-net

  # LocalStack - AWS service emulator (S3, Athena, etc.)
  localstack:
    image: localstack/localstack:latest
    container_name: genai-toolbox-localstack
    ports:
      - "4566:4566"  # LocalStack Gateway
      - "4510-4559:4510-4559"  # External services port range
    environment:
      SERVICES: s3,athena,glue,dynamodb,sts,iam
      DEBUG: 1
      DATA_DIR: /tmp/localstack/data
      DOCKER_HOST: unix:///var/run/docker.sock
      AWS_DEFAULT_REGION: us-east-1
      AWS_ACCESS_KEY_ID: test
      AWS_SECRET_ACCESS_KEY: test
    volumes:
      - localstack-data:/tmp/localstack
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - genai-toolbox-net

  # PostgreSQL - for Redshift-compatible testing
  postgres:
    image: postgres:15-alpine
    container_name: genai-toolbox-postgres
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: testdb
    volumes:
      - postgres-data:/var/lib/postgresql/data
      - ./postgres-init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - genai-toolbox-net

  # MongoDB - for DocumentDB-compatible testing
  mongodb:
    image: mongo:7
    container_name: genai-toolbox-mongodb
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: password
    volumes:
      - mongodb-data:/data/db
    networks:
      - genai-toolbox-net

  # Gremlin Server - for Neptune-compatible testing
  gremlin-server:
    image: tinkerpop/gremlin-server:latest
    container_name: genai-toolbox-gremlin
    ports:
      - "8182:8182"
    volumes:
      - ./gremlin-server.yaml:/opt/gremlin-server/conf/gremlin-server.yaml
    networks:
      - genai-toolbox-net

networks:
  genai-toolbox-net:
    driver: bridge

volumes:
  minio-data:
  localstack-data:
  postgres-data:
  mongodb-data:
